globals:
  - id: quick_servo_target
    type: float
    restore_value: no
    initial_value: '90.0'
  - id: quick_servo_return
    type: float
    restore_value: no
    initial_value: '-90.0'

# Number components for Home Assistant UI
number:
  - platform: template
    name: "Quick Servo Target Position"
    id: quick_servo_target_ui
    min_value: -100
    max_value: 100
    step: 1
    initial_value: 90
    set_action:
      - lambda: |-
          id(quick_servo_target) = x;
    on_value:
      - lambda: |-
          id(quick_servo_target) = x;

  - platform: template
    name: "Quick Servo Return Position"
    id: quick_servo_return_ui
    min_value: -100
    max_value: 100
    step: 1
    initial_value: -90
    set_action:
      - lambda: |-
          id(quick_servo_return) = x;
    on_value:
      - lambda: |-
          id(quick_servo_return) = x;

# Button configuration
button:
  # Button to gradually change the servo position from -100 to 100 and back
  - platform: template
    name: "Gradually Change Servo Position"
    on_press:
      then:
        # Log the start of gradual servo position change
        - logger.log: "Starting gradual servo position change from -100 to 100"
        # Reset position to -100 at the start
        - lambda: |-
            id(servo_position).publish_state(-100.0);
        # Repeat 200 times to increment the position
        - repeat:
            count: 200
            then:
              - lambda: |-
                  float position = -100.0 + (id(servo_position).state + 100.0); // Start from current progress
                  position = std::min(position + 1.0, 100.0); // Ensure we don't exceed 100
                  id(servo_position).publish_state(position);
              # Delay to spread over 20 seconds (20s / 200 steps)
              - delay: 50ms
        # Wait for 3 seconds
        - delay: 3s
        # Log the start of gradual servo position change back to -100
        - logger.log: "Starting gradual servo position change back to -100"
        # Reset position to 100 before decrementing
        - lambda: |-
            id(servo_position).publish_state(100.0);
        # Repeat 200 times to decrement the position
        - repeat:
            count: 200
            then:
              - lambda: |-
                  float position = 100.0 - (100.0 - id(servo_position).state); // Start from current progress
                  position = std::max(position - 1.0, -100.0); // Ensure we don't go below -100
                  id(servo_position).publish_state(position);
              # Delay to spread over 20 seconds (20s / 200 steps)
              - delay: 50ms

  # Button to move servo to target position, wait, and return
  - platform: template
    name: "Move Servo and Return"
    on_press:
      then:
        # Log the target position
        - logger.log: |-
            sprintf("Moving servo to target position: %.1f", id(quick_servo_target).state);
        # Move servo to target position
        - lambda: |-
            id(servo_position).publish_state(id(quick_servo_target));
        # Wait for 5 seconds
        - delay: 5s
        # Log the return position
        - logger.log: |-
            sprintf("Returning servo to position: %.1f", id(quick_servo_return).state);
        # Move servo back to return position
        - lambda: |-
            id(servo_position).publish_state(id(quick_servo_return));
